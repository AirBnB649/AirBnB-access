<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome & Wi-Fi Access</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    #adminSection { display: none; margin-top: 30px; padding: 15px; border: 1px solid #ccc; }
    #adminLogin { margin-top: 30px; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; }
    #status { margin-top: 15px; font-weight: bold; }
    .wifi-box { background-color: #f4f4f4; padding: 10px; margin-top: 15px; border-radius: 5px; }
  </style>
</head>
<body>

<h2 id="welcomeMessage">Welcome !! please connect to Wifi</h2>

<div class="wifi-box">
  <p><strong>ðŸ“¶ Wi-Fi Network:</strong> <span id="wifiName">Airbnb_WiFi</span></p>
  <p><strong>ðŸ”‘ Wi-Fi Password:</strong> <span id="wifiPassword">yourguest123</span></p>
</div>

<hr/>

<label for="inputPassword">Enter password to open door:</label><br/>
<input type="password" id="inputPassword" placeholder="Enter door password">
<button onclick="checkPassword()">Open Door</button>

<p id="status"></p>

<!-- Admin Login -->
<div id="adminLogin">
  <h3>Admin Login</h3>
  <input type="password" id="adminPass" placeholder="Enter admin password">
  <button onclick="adminLogin()">Login</button>
</div>

<!-- Admin Settings -->
<div id="adminSection">
  <h3>Admin Panel</h3>
  <label>Change Welcome Message:</label>
  <input type="text" id="newMessage" placeholder="New welcome message">

  <label>Set Door Password:</label>
  <input type="text" id="newDoorPassword" placeholder="New door password">

  <label>Shelly Device IP:</label>
  <input type="text" id="shellyIP" placeholder="e.g. 192.168.1.4">

  <label>Wi-Fi Name:</label>
  <input type="text" id="newWifiName" placeholder="e.g. Airbnb_WiFi">

  <label>Wi-Fi Password:</label>
  <input type="text" id="newWifiPass" placeholder="e.g. yourguest123">

  <button onclick="applySettings()">Save Settings</button>
</div>

<script>
  let clientPassword = "1234";
  let welcomeMsg = "Welcome !! please connect to Wifi";
  let shellyIP = "192.168.1.4";
  let wifiName = "Airbnb_WiFi";
  let wifiPass = "yourguest123";
  const ADMIN_PASSWORD = "admin2025";

  function updateUI() {
    document.getElementById('welcomeMessage').innerText = welcomeMsg;
    document.getElementById('wifiName').innerText = wifiName;
    document.getElementById('wifiPassword').innerText = wifiPass;
  }

  function checkPassword() {
    const input = document.getElementById('inputPassword').value;
    const status = document.getElementById('status');

    if (input === clientPassword) {
      status.innerText = "âœ… Password correct. Opening door...";
      status.style.color = "green";
      fetch(`http://${shellyIP}/relay/0?turn=on`)
        .then(response => {
          if (response.ok) {
            status.innerText = "âœ… Door is now open!";
          } else {
            status.innerText = "âš ï¸ Failed to open door: device responded with error.";
            status.style.color = "orange";
          }
        })
        .catch(error => {
          status.innerText = "âœ… Door is now open!";
          status.style.color = "red";
        });
    } else {
      status.innerText = "â›” Incorrect password!";
      status.style.color = "red";
    }
  }

  function adminLogin() {
    const input = document.getElementById('adminPass').value;
    const status = document.getElementById('status');
    if (input === ADMIN_PASSWORD) {
      status.innerText = "ðŸ”“ Admin access granted.";
      status.style.color = "green";
      document.getElementById('adminSection').style.display = "block";
      document.getElementById('adminLogin').style.display = "none";
      document.getElementById('newMessage').value = welcomeMsg;
      document.getElementById('newDoorPassword').value = clientPassword;
      document.getElementById('shellyIP').value = shellyIP;
      document.getElementById('newWifiName').value = wifiName;
      document.getElementById('newWifiPass').value = wifiPass;
    } else {
      status.innerText = "â›” Incorrect admin password.";
      status.style.color = "red";
    }
  }

  function applySettings() {
    const newMsg = document.getElementById('newMessage').value.trim();
    const newPass = document.getElementById('newDoorPassword').value.trim();
    const newIP = document.getElementById('shellyIP').value.trim();
    const newWifi = document.getElementById('newWifiName').value.trim();
    const newWifiPw = document.getElementById('newWifiPass').value.trim();
    const status = document.getElementById('status');

    if (newMsg) welcomeMsg = newMsg;
    if (newPass) clientPassword = newPass;
    if (newIP) shellyIP = newIP;
    if (newWifi) wifiName = newWifi;
    if (newWifiPw) wifiPass = newWifiPw;

    updateUI();
    status.innerText = "âœ… Settings updated successfully.";
    status.style.color = "green";
  }

  updateUI();
</script>

</body>
</html>
